<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Predictions â€” FPL Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:       #080c14;
      --surface:  #0e1420;
      --card:     #131b2e;
      --card2:    #18243d;
      --border:   #1e2d47;
      --accent:   #00d4aa;
      --blue:     #3b82f6;
      --amber:    #f59e0b;
      --danger:   #ef4444;
      --purple:   #a855f7;
      --text:     #e2e8f0;
      --muted:    #4a5f7a;
      --font-h:   'Bebas Neue', sans-serif;
      --font-b:   'Syne', sans-serif;
      --font-m:   'JetBrains Mono', monospace;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-b);
      min-height: 100vh;
    }

    /* â”€â”€ diagonal grid bg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background-image:
        repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 40px,
          rgba(0,212,170,0.015) 40px,
          rgba(0,212,170,0.015) 41px
        );
    }

    /* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; height: 60px;
      background: rgba(8,12,20,0.92);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    .nav-logo { font-family: var(--font-h); font-size: 1.6rem; color: var(--accent); text-decoration: none; letter-spacing: 2px; }
    .nav-logo span { color: var(--text); }
    .nav-links { display: flex; gap: 0.25rem; list-style: none; }
    .nav-links a {
      padding: 0.4rem 0.9rem; border-radius: 6px; text-decoration: none;
      font-size: 0.82rem; font-weight: 600; color: var(--muted); transition: all 0.2s;
    }
    .nav-links a:hover  { color: var(--text); background: var(--card); }
    .nav-links a.active { color: var(--blue); background: rgba(59,130,246,0.1); }

    /* â”€â”€ Page wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page { max-width: 1100px; margin: 0 auto; padding: 2.5rem 2rem; position: relative; z-index: 1; }

    /* â”€â”€ Page header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page-head {
      display: flex; align-items: flex-end; justify-content: space-between;
      margin-bottom: 2rem; gap: 1rem; flex-wrap: wrap;
    }
    .label {
      font-family: var(--font-m); font-size: 0.65rem;
      letter-spacing: 3px; text-transform: uppercase; color: var(--muted);
      margin-bottom: 0.4rem;
    }
    .page-title {
      font-family: var(--font-h); font-size: 3.5rem;
      letter-spacing: 3px; line-height: 0.95;
    }
    .page-title span { color: var(--blue); }

    /* â”€â”€ GW Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gw-tabs {
      display: flex; gap: 0.4rem; flex-wrap: wrap;
    }
    .gw-tab {
      font-family: var(--font-m); font-size: 0.7rem;
      letter-spacing: 1px; padding: 0.4rem 1rem;
      border-radius: 6px; border: 1px solid var(--border);
      background: transparent; color: var(--muted);
      cursor: pointer; transition: all 0.2s;
    }
    .gw-tab:hover  { border-color: var(--blue); color: var(--blue); }
    .gw-tab.active { border-color: var(--blue); color: var(--blue); background: rgba(59,130,246,0.12); }

    /* â”€â”€ Stats Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-bar {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 1rem; margin-bottom: 2rem;
    }
    .stat-box {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 12px; padding: 1.25rem; text-align: center;
      position: relative; overflow: hidden;
    }
    .stat-box::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: var(--stat-color, var(--accent));
    }
    .stat-val {
      font-family: var(--font-h); font-size: 2.4rem;
      letter-spacing: 1px; line-height: 1;
      color: var(--stat-color, var(--accent));
    }
    .stat-key { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 2px; margin-top: 0.3rem; }
    .stat-box.blue   { --stat-color: var(--blue); }
    .stat-box.amber  { --stat-color: var(--amber); }
    .stat-box.danger { --stat-color: var(--danger); }

    /* â”€â”€ Fixtures List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fixtures-wrap {
      display: flex; flex-direction: column; gap: 1rem;
    }

    /* â”€â”€ Fixture Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fixture-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      transition: border-color 0.25s, box-shadow 0.25s;
      scroll-margin-top: 80px;
    }
    .fixture-card:hover { border-color: rgba(59,130,246,0.4); }
    .fixture-card.submitted { border-color: rgba(0,212,170,0.3); }
    .fixture-card.correct   { border-color: rgba(0,212,170,0.5); box-shadow: 0 0 20px rgba(0,212,170,0.08); }
    .fixture-card.wrong     { border-color: rgba(239,68,68,0.3); }

    .fixture-top {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem 2rem;
    }

    /* Team side */
    .team-side { display: flex; align-items: center; gap: 1rem; }
    .team-side.away { flex-direction: row-reverse; text-align: right; }
    .team-crest {
      width: 52px; height: 52px; border-radius: 50%;
      background: var(--surface);
      border: 1.5px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; flex-shrink: 0;
      transition: transform 0.2s;
    }
    .fixture-card:hover .team-crest { transform: scale(1.05); }
    .team-name-wrap {}
    .team-name { font-size: 1.05rem; font-weight: 700; line-height: 1.1; }
    .team-short { font-family: var(--font-m); font-size: 0.62rem; color: var(--muted); margin-top: 2px; }

    /* Center VS section */
    .fixture-center { text-align: center; }
    .vs-big {
      font-family: var(--font-h); font-size: 1.4rem; letter-spacing: 3px;
      color: var(--muted); line-height: 1;
    }
    .fixture-time {
      font-family: var(--font-m); font-size: 0.65rem;
      color: var(--amber); display: block; margin-top: 4px; letter-spacing: 1px;
    }
    .live-badge {
      display: inline-flex; align-items: center; gap: 4px;
      background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3);
      color: var(--danger); font-family: var(--font-m);
      font-size: 0.6rem; letter-spacing: 1px;
      padding: 2px 8px; border-radius: 20px; margin-top: 4px;
    }
    .live-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--danger); animation: pulse 1s infinite; }

    /* â”€â”€ Score Input Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fixture-bottom {
      border-top: 1px solid var(--border);
      padding: 1.25rem 2rem;
      display: flex; align-items: center; gap: 1.5rem;
      background: var(--surface);
      flex-wrap: wrap;
    }
    .pred-label-txt { font-size: 0.7rem; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; flex-shrink: 0; }

    .score-input-row {
      display: flex; align-items: center; gap: 0.75rem; flex: 1;
    }
    .score-input {
      width: 52px; height: 52px;
      background: var(--card2); border: 2px solid var(--border);
      border-radius: 10px; color: var(--text);
      font-family: var(--font-h); font-size: 1.8rem; letter-spacing: 1px;
      text-align: center; outline: none;
      transition: border-color 0.2s, background 0.2s;
      -moz-appearance: textfield;
    }
    .score-input::-webkit-inner-spin-button,
    .score-input::-webkit-outer-spin-button { -webkit-appearance: none; }
    .score-input:focus { border-color: var(--blue); background: rgba(59,130,246,0.06); }
    .score-input:disabled { opacity: 0.5; cursor: not-allowed; }
    .score-sep {
      font-family: var(--font-h); font-size: 1.8rem; color: var(--muted);
    }

    .btn-submit {
      font-family: var(--font-m); font-size: 0.72rem; letter-spacing: 1px;
      padding: 0.6rem 1.4rem; border-radius: 8px;
      border: none; cursor: pointer; transition: all 0.2s;
      background: var(--blue); color: white; font-weight: 700;
    }
    .btn-submit:hover { background: #5b9cf6; transform: translateY(-1px); }
    .btn-submit:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
    .btn-edit {
      font-family: var(--font-m); font-size: 0.7rem;
      padding: 0.5rem 1rem; border-radius: 8px;
      border: 1px solid var(--border); background: transparent;
      color: var(--muted); cursor: pointer; transition: all 0.2s;
    }
    .btn-edit:hover { border-color: var(--amber); color: var(--amber); }

    /* Result badge */
    .result-badge {
      display: flex; align-items: center; gap: 6px;
      font-family: var(--font-m); font-size: 0.7rem;
      padding: 0.4rem 1rem; border-radius: 8px;
      flex-shrink: 0;
    }
    .result-badge.correct { background: rgba(0,212,170,0.12); color: var(--accent); border: 1px solid rgba(0,212,170,0.25); }
    .result-badge.wrong   { background: rgba(239,68,68,0.12);  color: var(--danger); border: 1px solid rgba(239,68,68,0.25); }
    .result-badge.pending { background: rgba(245,158,11,0.1);  color: var(--amber);  border: 1px solid rgba(245,158,11,0.2); }
    .result-badge.exact   { background: rgba(168,85,247,0.12); color: var(--purple); border: 1px solid rgba(168,85,247,0.3); }

    /* Actual score display */
    .actual-score {
      display: flex; align-items: center; gap: 6px;
      font-family: var(--font-m); font-size: 0.8rem;
    }
    .actual-score .score-num {
      font-size: 1rem; font-weight: 700; color: var(--accent);
    }
    .actual-label { font-size: 0.6rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

    /* FDR row */
    .fdr-row {
      display: flex; align-items: center; gap: 8px; margin-top: 0;
      padding: 0.6rem 2rem;
      border-top: 1px solid rgba(255,255,255,0.04);
      background: rgba(0,0,0,0.15);
    }
    .fdr-label-txt { font-family: var(--font-m); font-size: 0.6rem; color: var(--muted); letter-spacing: 1px; }
    .fdr-pip {
      font-family: var(--font-m); font-size: 0.65rem;
      padding: 2px 8px; border-radius: 4px; font-weight: 700;
    }
    .fdr-1,.fdr-2 { background: rgba(0,212,170,0.15); color: var(--accent); }
    .fdr-3 { background: rgba(245,158,11,0.15); color: var(--amber); }
    .fdr-4,.fdr-5 { background: rgba(239,68,68,0.15); color: var(--danger); }

    /* â”€â”€ No fixtures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty {
      text-align: center; padding: 4rem 2rem; color: var(--muted);
      background: var(--card); border: 1px dashed var(--border); border-radius: 16px;
    }
    .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
    .empty-txt  { font-family: var(--font-h); font-size: 1.4rem; letter-spacing: 2px; }

    /* â”€â”€ Accuracy History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .history-section { margin-top: 3rem; }
    .history-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
      gap: 0.75rem; margin-top: 1rem;
    }
    .history-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 1rem; text-align: center;
      transition: border-color 0.2s;
    }
    .history-card.correct { border-color: rgba(0,212,170,0.3); }
    .history-card.exact   { border-color: rgba(168,85,247,0.4); }
    .history-card.wrong   { border-color: rgba(239,68,68,0.2); }
    .history-gw   { font-family: var(--font-m); font-size: 0.6rem; color: var(--muted); letter-spacing: 1px; margin-bottom: 4px; }
    .history-match{ font-size: 0.72rem; font-weight: 600; margin-bottom: 6px; line-height: 1.3; }
    .history-scores{ font-family: var(--font-m); font-size: 0.78rem; }
    .history-scores .pred-s { color: var(--blue); }
    .history-scores .act-s  { color: var(--accent); }
    .history-result{ margin-top: 6px; }

    /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    @keyframes fadeSlide {
      from { opacity:0; transform: translateY(16px); }
      to   { opacity:1; transform: translateY(0); }
    }
    .fixture-card { animation: fadeSlide 0.35s ease both; }
    .fixture-card:nth-child(1) { animation-delay: 0.05s; }
    .fixture-card:nth-child(2) { animation-delay: 0.10s; }
    .fixture-card:nth-child(3) { animation-delay: 0.15s; }
    .fixture-card:nth-child(4) { animation-delay: 0.20s; }
    .fixture-card:nth-child(5) { animation-delay: 0.25s; }
    .fixture-card:nth-child(6) { animation-delay: 0.30s; }
    .fixture-card:nth-child(7) { animation-delay: 0.35s; }
    .fixture-card:nth-child(8) { animation-delay: 0.40s; }
    .fixture-card:nth-child(9) { animation-delay: 0.45s; }
    .fixture-card:nth-child(10){ animation-delay: 0.50s; }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    @media (max-width: 640px) {
      .stats-bar { grid-template-columns: repeat(2,1fr); }
      .fixture-top { padding: 1rem; }
      .fixture-bottom { padding: 1rem; gap: 1rem; }
      .team-name { font-size: 0.9rem; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav>
  <a href="../index.html" class="nav-logo">FPL<span>HUB</span></a>
  <ul class="nav-links">
    <li><a href="../index.html">ğŸ  Home</a></li>
    <li><a href="fantasy.html">âš¡ Fantasy</a></li>
    <li><a href="predictions.html" class="active">ğŸ¯ Predict</a></li>
    <li><a href="watchalong.html">ğŸ“º Watch Along</a></li>
    <li><a href="../overlay.html" target="_blank">ğŸ® OBS</a></li>
  </ul>
</nav>

<div class="page">

  <!-- â”€â”€ Page Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page-head">
    <div>
      <div class="label">// match predictions</div>
      <h1 class="page-title">PREDICT <span>THE</span><br>SCORES</h1>
    </div>
    <div class="gw-tabs" id="gwTabs"></div>
  </div>

  <!-- â”€â”€ Stats Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="stats-bar">
    <div class="stat-box">
      <div class="stat-val" id="s-submitted">0</div>
      <div class="stat-key">Submitted</div>
    </div>
    <div class="stat-box blue">
      <div class="stat-val" id="s-correct">0</div>
      <div class="stat-key">Correct Result</div>
    </div>
    <div class="stat-box" style="--stat-color:var(--purple)">
      <div class="stat-val" id="s-exact">0</div>
      <div class="stat-key">Exact Score</div>
    </div>
    <div class="stat-box amber">
      <div class="stat-val" id="s-acc">0%</div>
      <div class="stat-key">Accuracy</div>
    </div>
  </div>

  <!-- â”€â”€ Fixtures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="fixtures-wrap" id="fixturesWrap"></div>

  <!-- â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="history-section" id="historySection" style="display:none">
    <div class="label">// prediction history</div>
    <h2 style="font-family:var(--font-h);font-size:1.8rem;letter-spacing:2px;margin-bottom:0.25rem">
      PAST <span style="color:var(--blue)">RESULTS</span>
    </h2>
    <div class="history-grid" id="historyGrid"></div>
  </div>

</div>

<footer style="border-top:1px solid var(--border);padding:1.5rem 2rem;text-align:center;font-size:0.72rem;color:var(--muted);position:relative;z-index:1;">
  Predictions saved locally Â· Syncs with OBS overlay Â·
  <a href="../index.html" style="color:var(--blue);text-decoration:none;">â† Home</a>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = 'fpl_predictions';
const CACHE_URL   = '../data/cache.json';

// Fallback static fixtures (update each GW)
const STATIC_FIXTURES = {
  28: [
    { id:101, gw:28, homeTeam:'Arsenal',      homeShort:'ARS', homeEmoji:'ğŸ”´', awayTeam:'Man City',    awayShort:'MCI', awayEmoji:'ğŸ”µ', kickoff:'2025-03-15T12:30:00', finished:false, homeScore:null, awayScore:null, homeDiff:4, awayDiff:2 },
    { id:102, gw:28, homeTeam:'Liverpool',    homeShort:'LIV', homeEmoji:'ğŸ”´', awayTeam:'Chelsea',     awayShort:'CHE', awayEmoji:'ğŸ”µ', kickoff:'2025-03-15T15:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:3, awayDiff:3 },
    { id:103, gw:28, homeTeam:'Man United',   homeShort:'MUN', homeEmoji:'ğŸ”´', awayTeam:'Tottenham',   awayShort:'TOT', awayEmoji:'âšª', kickoff:'2025-03-15T17:30:00', finished:false, homeScore:null, awayScore:null, homeDiff:3, awayDiff:2 },
    { id:104, gw:28, homeTeam:'Aston Villa',  homeShort:'AVL', homeEmoji:'ğŸŸ£', awayTeam:'Newcastle',   awayShort:'NEW', awayEmoji:'âš«', kickoff:'2025-03-16T14:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:2, awayDiff:3 },
    { id:105, gw:28, homeTeam:'Brighton',     homeShort:'BHA', homeEmoji:'ğŸ”µ', awayTeam:'West Ham',    awayShort:'WHU', awayEmoji:'ğŸ”´', kickoff:'2025-03-16T16:30:00', finished:false, homeScore:null, awayScore:null, homeDiff:2, awayDiff:4 },
    { id:106, gw:28, homeTeam:'Brentford',    homeShort:'BRE', homeEmoji:'ğŸ”´', awayTeam:'Everton',     awayShort:'EVE', awayEmoji:'ğŸ”µ', kickoff:'2025-03-16T14:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:1, awayDiff:3 },
    { id:107, gw:28, homeTeam:'Wolves',       homeShort:'WOL', homeEmoji:'ğŸŸ¡', awayTeam:'Fulham',      awayShort:'FUL', awayEmoji:'âšª', kickoff:'2025-03-16T14:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:3, awayDiff:2 },
    { id:108, gw:28, homeTeam:'Crystal Palace',homeShort:'CRY',homeEmoji:'ğŸ”´', awayTeam:'Leicester',   awayShort:'LEI', awayEmoji:'ğŸ”µ', kickoff:'2025-03-16T14:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:2, awayDiff:4 },
    { id:109, gw:28, homeTeam:'Nottm Forest', homeShort:'NFO', homeEmoji:'ğŸ”´', awayTeam:'Bournemouth', awayShort:'BOU', awayEmoji:'ğŸ”´', kickoff:'2025-03-16T14:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:3, awayDiff:2 },
    { id:110, gw:28, homeTeam:'Southampton',  homeShort:'SOU', homeEmoji:'ğŸ”´', awayTeam:'Ipswich',     awayShort:'IPS', awayEmoji:'ğŸ”µ', kickoff:'2025-03-17T20:00:00', finished:false, homeScore:null, awayScore:null, homeDiff:1, awayDiff:1 },
  ],
  27: [
    { id:91, gw:27, homeTeam:'Man City',   homeShort:'MCI', homeEmoji:'ğŸ”µ', awayTeam:'Liverpool',  awayShort:'LIV', awayEmoji:'ğŸ”´', kickoff:'2025-03-08T12:30:00', finished:true, homeScore:1, awayScore:2, homeDiff:3, awayDiff:2 },
    { id:92, gw:27, homeTeam:'Chelsea',    homeShort:'CHE', homeEmoji:'ğŸ”µ', awayTeam:'Arsenal',    awayShort:'ARS', awayEmoji:'ğŸ”´', kickoff:'2025-03-08T15:00:00', finished:true, homeScore:0, awayScore:1, homeDiff:3, awayDiff:3 },
    { id:93, gw:27, homeTeam:'Newcastle',  homeShort:'NEW', homeEmoji:'âš«', awayTeam:'Man United', awayShort:'MUN', awayEmoji:'ğŸ”´', kickoff:'2025-03-09T14:00:00', finished:true, homeScore:3, awayScore:0, homeDiff:2, awayDiff:5 },
  ],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentGW   = 28;
let allFixtures = { ...STATIC_FIXTURES };
let predictions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOAD CACHE (if available)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadCache() {
  try {
    const res  = await fetch(CACHE_URL + '?t=' + Date.now());
    const data = await res.json();
    if (data.fixtures?.length) {
      // Group by GW
      const grouped = {};
      data.fixtures.forEach(f => {
        if (!grouped[f.gw]) grouped[f.gw] = [];
        grouped[f.gw].push(f);
      });
      // Merge into allFixtures (cache overrides static for fetched GWs)
      Object.assign(allFixtures, grouped);
      if (data.currentGW) currentGW = data.currentGW;
    }
  } catch(e) { /* use static */ }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SAVE PREDICTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function savePrediction(fixtureId, home, away) {
  predictions[fixtureId] = { home: parseInt(home), away: parseInt(away), ts: Date.now() };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(predictions));
}

function clearPrediction(fixtureId) {
  delete predictions[fixtureId];
  localStorage.setItem(STORAGE_KEY, JSON.stringify(predictions));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACCURACY CALC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcAccuracy() {
  let submitted = 0, correct = 0, exact = 0;
  Object.values(allFixtures).flat().forEach(f => {
    const pred = predictions[f.id];
    if (!pred) return;
    submitted++;
    if (!f.finished) return;
    const predResult = Math.sign(pred.home - pred.away);
    const actResult  = Math.sign(f.homeScore - f.awayScore);
    if (predResult === actResult) correct++;
    if (pred.home === f.homeScore && pred.away === f.awayScore) exact++;
  });
  return { submitted, correct, exact };
}

function updateStats() {
  const { submitted, correct, exact } = calcAccuracy();
  document.getElementById('s-submitted').textContent = submitted;
  document.getElementById('s-correct').textContent   = correct;
  document.getElementById('s-exact').textContent     = exact;
  document.getElementById('s-acc').textContent       = submitted > 0 ? Math.round(correct/submitted*100) + '%' : '0%';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FDR LABEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fdrLabel(d) {
  return ['','Very Easy','Easy','Medium','Hard','Very Hard'][d] || 'â€”';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER FIXTURE CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFixtureCard(f) {
  const pred    = predictions[f.id];
  const hasAct  = f.finished && f.homeScore !== null;
  const isLive  = !f.finished && f.homeScore !== null;

  // Determine result badge
  let badgeHtml = '';
  if (pred && hasAct) {
    const predResult = Math.sign(pred.home - pred.away);
    const actResult  = Math.sign(f.homeScore - f.awayScore);
    const isCorrect  = predResult === actResult;
    const isExact    = pred.home === f.homeScore && pred.away === f.awayScore;
    if (isExact)
      badgeHtml = `<span class="result-badge exact">ğŸ¯ EXACT SCORE!</span>`;
    else if (isCorrect)
      badgeHtml = `<span class="result-badge correct">âœ“ CORRECT</span>`;
    else
      badgeHtml = `<span class="result-badge wrong">âœ— WRONG</span>`;
  } else if (pred && isLive) {
    badgeHtml = `<span class="result-badge pending">â— LIVE</span>`;
  } else if (pred) {
    badgeHtml = `<span class="result-badge pending">âœ“ SAVED</span>`;
  }

  // Kick-off time display
  const koDate = new Date(f.kickoff);
  const timeStr = koDate.toLocaleDateString('en-GB', { weekday:'short', month:'short', day:'numeric' })
                + ' Â· ' + koDate.toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit' });

  const card = document.createElement('div');
  card.className = 'fixture-card' +
    (pred && hasAct ? (Math.sign(pred.home - pred.away) === Math.sign(f.homeScore - f.awayScore) ? ' correct' : ' wrong') : '') +
    (pred && !hasAct ? ' submitted' : '');
  card.id = `fixture-${f.id}`;

  card.innerHTML = `
    <div class="fixture-top">
      <!-- Home -->
      <div class="team-side home">
        <div class="team-crest">${f.homeEmoji || 'âš½'}</div>
        <div class="team-name-wrap">
          <div class="team-name">${f.homeTeam}</div>
          <div class="team-short">${f.homeShort}</div>
        </div>
      </div>

      <!-- Center -->
      <div class="fixture-center">
        ${isLive
          ? `<div class="vs-big">${f.homeScore} - ${f.awayScore}</div>
             <span class="live-badge"><span class="live-dot"></span> LIVE</span>`
          : hasAct
          ? `<div class="vs-big" style="color:var(--accent)">${f.homeScore} - ${f.awayScore}</div>
             <span class="fixture-time" style="color:var(--muted)">FT</span>`
          : `<div class="vs-big">VS</div>
             <span class="fixture-time">${timeStr}</span>`
        }
      </div>

      <!-- Away -->
      <div class="team-side away">
        <div class="team-crest">${f.awayEmoji || 'âš½'}</div>
        <div class="team-name-wrap">
          <div class="team-name">${f.awayTeam}</div>
          <div class="team-short">${f.awayShort}</div>
        </div>
      </div>
    </div>

    <!-- FDR row -->
    <div class="fdr-row">
      <span class="fdr-label-txt">FDR:</span>
      <span class="fdr-pip fdr-${f.homeDiff}">${f.homeShort} ${fdrLabel(f.homeDiff)}</span>
      <span style="color:var(--muted);font-size:0.6rem;">vs</span>
      <span class="fdr-pip fdr-${f.awayDiff}">${f.awayShort} ${fdrLabel(f.awayDiff)}</span>
    </div>

    <!-- Prediction Input -->
    <div class="fixture-bottom" id="bottom-${f.id}">
      <span class="pred-label-txt">YOUR PREDICTION</span>
      <div class="score-input-row">
        <input
          type="number" min="0" max="20"
          class="score-input" id="home-${f.id}"
          value="${pred ? pred.home : ''}"
          placeholder="0"
          ${hasAct ? 'disabled' : ''}
        />
        <span class="score-sep">:</span>
        <input
          type="number" min="0" max="20"
          class="score-input" id="away-${f.id}"
          value="${pred ? pred.away : ''}"
          placeholder="0"
          ${hasAct ? 'disabled' : ''}
        />
      </div>
      ${hasAct
        ? `${badgeHtml}`
        : `<button class="btn-submit" id="btn-${f.id}" onclick="submitPred(${f.id})">
             ${pred ? 'UPDATE' : 'SUBMIT â†’'}
           </button>
           ${pred ? `<button class="btn-edit" onclick="editPred(${f.id})">Clear</button>` : ''}
           ${badgeHtml}`
      }
      ${hasAct && pred
        ? `<div class="actual-score" style="margin-left:auto">
             <span class="actual-label">Predicted:</span>
             <span class="score-num">${pred.home}-${pred.away}</span>
           </div>`
        : ''
      }
    </div>
  `;

  // Enter key to submit
  card.querySelectorAll('.score-input').forEach(inp => {
    inp.addEventListener('keydown', e => { if(e.key==='Enter') submitPred(f.id); });
  });

  return card;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT / EDIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function submitPred(id) {
  const h = document.getElementById(`home-${id}`).value;
  const a = document.getElementById(`away-${id}`).value;
  if (h === '' || a === '') {
    const btn = document.getElementById(`btn-${id}`);
    btn.textContent = 'Enter both scores!';
    btn.style.background = 'var(--amber)';
    setTimeout(() => { btn.textContent = 'SUBMIT â†’'; btn.style.background = ''; }, 1500);
    return;
  }
  savePrediction(id, h, a);
  renderGW(currentGW);
  updateStats();
}

function editPred(id) {
  clearPrediction(id);
  renderGW(currentGW);
  updateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER GW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGW(gw) {
  currentGW = gw;
  const wrap = document.getElementById('fixturesWrap');
  wrap.innerHTML = '';

  // Update tab active states
  document.querySelectorAll('.gw-tab').forEach(t => {
    t.classList.toggle('active', parseInt(t.dataset.gw) === gw);
  });

  const fixtures = allFixtures[gw] || [];
  if (!fixtures.length) {
    wrap.innerHTML = `
      <div class="empty">
        <div class="empty-icon">ğŸ“­</div>
        <div class="empty-txt">NO FIXTURES FOR GW${gw}</div>
      </div>`;
    return;
  }

  fixtures.forEach(f => wrap.appendChild(renderFixtureCard(f)));

  // Scroll to anchor if hash present
  const hash = window.location.hash;
  if (hash) {
    const el = document.querySelector(hash);
    if (el) setTimeout(() => el.scrollIntoView({ behavior:'smooth' }), 300);
  }

  renderHistory();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHistory() {
  const past = [];
  Object.values(allFixtures).flat().forEach(f => {
    const pred = predictions[f.id];
    if (!pred || !f.finished) return;
    const isCorrect = Math.sign(pred.home - pred.away) === Math.sign(f.homeScore - f.awayScore);
    const isExact   = pred.home === f.homeScore && pred.away === f.awayScore;
    past.push({ f, pred, isCorrect, isExact });
  });

  const section = document.getElementById('historySection');
  const grid    = document.getElementById('historyGrid');
  if (!past.length) { section.style.display = 'none'; return; }
  section.style.display = 'block';

  grid.innerHTML = past.reverse().map(({ f, pred, isCorrect, isExact }) => `
    <div class="history-card ${isExact ? 'exact' : isCorrect ? 'correct' : 'wrong'}">
      <div class="history-gw">GW${f.gw}</div>
      <div class="history-match">${f.homeShort} vs ${f.awayShort}</div>
      <div class="history-scores">
        <span class="pred-s">${pred.home}-${pred.away}</span>
        <span style="color:var(--muted)"> / </span>
        <span class="act-s">${f.homeScore}-${f.awayScore}</span>
      </div>
      <div class="history-result">
        ${isExact
          ? '<span class="result-badge exact" style="font-size:0.58rem;padding:2px 6px;">ğŸ¯ EXACT</span>'
          : isCorrect
          ? '<span class="result-badge correct" style="font-size:0.58rem;padding:2px 6px;">âœ“</span>'
          : '<span class="result-badge wrong" style="font-size:0.58rem;padding:2px 6px;">âœ—</span>'
        }
      </div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD GW TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildTabs() {
  const gws   = Object.keys(allFixtures).map(Number).sort((a,b) => b-a);
  const tabs  = document.getElementById('gwTabs');
  tabs.innerHTML = gws.map(gw => `
    <button class="gw-tab ${gw===currentGW?'active':''}" data-gw="${gw}" onclick="renderGW(${gw})">
      GW${gw}
    </button>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
  await loadCache();
  buildTabs();
  renderGW(currentGW);
  updateStats();
}

init();
</script>
</body>
</html>
